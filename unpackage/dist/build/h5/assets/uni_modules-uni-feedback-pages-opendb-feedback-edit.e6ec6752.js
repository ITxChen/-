import{D as e,s as t,v as a,x as o,K as n,J as s,o as i,c as l,w as m,i as r,f as u,a as d,ah as f,r as c,B as p}from"./index-071c8e17.js";import{_ as b}from"./uni-forms-item.43ba2202.js";import{r as h}from"./uni-app.es.af5b3bc2.js";import{v as g,_ as D}from"./opendb-feedback.c9f9ac16.js";import{_}from"./uni-easyinput.06277378.js";import{_ as V}from"./uni-forms.4269e4f0.js";import{_ as y}from"./_plugin-vue_export-helper.1b428a4d.js";import"./uni-icons.c3f4a5ee.js";const v=e.database();function j(e){let t={};for(let a in g)e.indexOf(a)>-1&&(t[a]=g[a]);return t}const k=y({data(){let e={content:"",imgs:[],contact:"",mobile:""};return{formData:e,formOptions:{},rules:{...j(Object.keys(e))}}},onLoad(e){if(e.id){const t=e.id;this.formDataId=t,this.getDetail(t)}},onReady(){this.$refs.form.setRules(this.rules)},methods:{submit(){t({mask:!0}),this.$refs.form.validate().then((e=>{this.submitForm(e)})).catch((()=>{a()}))},submitForm(e){v.collection("opendb-feedback").doc(this.formDataId).update(e).then((e=>{o({icon:"none",title:"修改成功"}),this.getOpenerEventChannel().emit("refreshData"),setTimeout((()=>n()),500)})).catch((e=>{s({content:e.message||"请求服务失败",showCancel:!1})})).finally((()=>{a()}))},getDetail(e){t({mask:!0}),v.collection("opendb-feedback").doc(e).field("content,imgs,contact,mobile").get().then((e=>{const t=e.result.data[0];t&&(this.formData=t)})).catch((e=>{s({content:e.message||"请求服务失败",showCancel:!1})})).finally((()=>{a()}))}}},[["render",function(e,t,a,o,n,s){const g=f,y=h(c("uni-forms-item"),b),v=h(c("uni-file-picker"),D),j=h(c("uni-easyinput"),_),k=p,x=r,C=h(c("uni-forms"),V);return i(),l(x,{class:"uni-container"},{default:m((()=>[u(C,{ref:"form",value:n.formData,"validate-trigger":"submit","err-show-type":"toast"},{default:m((()=>[u(y,{name:"content",label:"留言内容/回复内容",required:""},{default:m((()=>[u(g,{onInput:t[0]||(t[0]=t=>e.binddata("content",t.detail.value)),class:"uni-textarea-border",modelValue:n.formData.content,"onUpdate:modelValue":t[1]||(t[1]=e=>n.formData.content=e),trim:"right"},null,8,["modelValue"])])),_:1}),u(y,{name:"imgs",label:"图片列表"},{default:m((()=>[u(v,{"file-mediatype":"image",limit:6,"return-type":"array",modelValue:n.formData.imgs,"onUpdate:modelValue":t[2]||(t[2]=e=>n.formData.imgs=e)},null,8,["modelValue"])])),_:1}),u(y,{name:"contact",label:"联系人"},{default:m((()=>[u(j,{modelValue:n.formData.contact,"onUpdate:modelValue":t[3]||(t[3]=e=>n.formData.contact=e),trim:"both"},null,8,["modelValue"])])),_:1}),u(y,{name:"mobile",label:"联系电话"},{default:m((()=>[u(j,{modelValue:n.formData.mobile,"onUpdate:modelValue":t[4]||(t[4]=e=>n.formData.mobile=e),trim:"both"},null,8,["modelValue"])])),_:1}),u(x,{class:"uni-button-group"},{default:m((()=>[u(k,{type:"primary",class:"uni-button",onClick:s.submit},{default:m((()=>[d("提交")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["value"])])),_:1})}],["__scopeId","data-v-f6e45a49"]]);export{k as default};
