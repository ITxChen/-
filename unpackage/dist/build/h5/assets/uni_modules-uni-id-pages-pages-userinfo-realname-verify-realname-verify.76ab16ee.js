import{D as e,a4 as t,J as i,s as a,a5 as r,v as s,o as l,c as o,w as n,i as u,f as d,g as f,a as m,t as c,d as p,F as y,r as h,A as g,B as C,l as v}from"./index-071c8e17.js";import{_,a as F}from"./uni-list.2fc3efd0.js";import{r as N}from"./uni-app.es.af5b3bc2.js";import{_ as I}from"./uni-easyinput.06277378.js";import{_ as j}from"./uni-forms-item.43ba2202.js";import{_ as k}from"./uni-forms.4269e4f0.js";import{_ as x}from"./uni-id-pages-agreements.57117dab.js";import{m as b}from"./login-page.mixin.6cb7caa8.js";import{s as A,m as V}from"./store.7e8d93e4.js";import{_ as T}from"./_plugin-vue_export-helper.1b428a4d.js";import"./uni-icons.c3f4a5ee.js";import"./uni-popup-dialog.47a94e26.js";import"./uni-popup.8c668c17.js";const w=""+new URL("face-verify-icon-da277dd7.svg",import.meta.url).href;e.importObject("uni-id-co");const U=T({mixins:[b],data:()=>({realName:"",idCard:"",certifyId:"",verifyFail:!1,verifyFailCode:0,verifyFailTitle:"",verifyFailContent:""}),computed:{userInfo:()=>A.userInfo,certifyIdNext(){return Boolean(this.realName)&&Boolean(this.idCard)&&this.needAgreements&&this.agree},isCertify(){return this.userInfo.realNameAuth&&2===this.userInfo.realNameAuth.authStatus},isDev:()=>!1},onLoad(){const e=t("uni-id-pages-temp-frv");e&&(this.realName=e.realName,this.idCard=e.idCard)},methods:{async getCertifyId(){if(this.certifyIdNext)return i({content:"暂不支持实名认证",showCancel:!1})},startFacialRecognitionVerify(){},async getFrvAuthResult(){const t=e.importObject("uni-id-co",{customUI:!0});try{a({title:"验证中...",mask:!1});const e=await t.getFrvAuthResult({certifyId:this.certifyId}),{errCode:l,...o}=e;this.verifyFailContent&&console.log(`[frv-debug] 客户端刷脸失败，由实人认证服务查询具体原因，原因：${this.verifyFailContent}`),i({content:"实名认证成功",showCancel:!1,success:()=>{V.setUserInfo({realNameAuth:o}),this.verifyFail=!1}}),r({key:"uni-id-pages-temp-frv"})}catch(l){this.verifyFail=!0,this.verifyFailTitle=l.errMsg,console.error(JSON.stringify(l))}finally{s()}},retry(){10013!==this.verifyFailCode?this.getCertifyId():this.verifyFail=!1}}},[["render",function(e,t,i,a,r,s){const b=N(h("uni-list-item"),_),A=N(h("uni-list"),F),V=g,T=u,U=C,B=v,D=N(h("uni-easyinput"),I),O=N(h("uni-forms-item"),j),R=N(h("uni-forms"),k),J=N(h("uni-id-pages-agreements"),x);return l(),o(T,null,{default:n((()=>[s.isCertify?(l(),o(A,{key:0},{default:n((()=>[d(b,{class:"item",title:"姓名",rightText:s.userInfo.realNameAuth.realName},null,8,["rightText"]),d(b,{class:"item",title:"身份证号码",rightText:s.userInfo.realNameAuth.identity},null,8,["rightText"])])),_:1})):(l(),o(T,{key:1,class:"uni-content"},{default:n((()=>[r.verifyFail?(l(),f(y,{key:0},[d(T,{class:"face-icon"},{default:n((()=>[d(V,{src:w,class:"face-icon-image"})])),_:1}),d(T,{class:"error-title"},{default:n((()=>[m(c(r.verifyFailTitle),1)])),_:1}),d(T,{class:"error-description"},{default:n((()=>[m(c(r.verifyFailContent),1)])),_:1}),10013!==r.verifyFailCode?(l(),o(U,{key:0,type:"primary",onClick:s.retry},{default:n((()=>[m("重新开始验证")])),_:1},8,["onClick"])):(l(),o(U,{key:1,type:"primary",onClick:s.retry},{default:n((()=>[m("返回")])),_:1},8,["onClick"])),s.isDev?(l(),o(T,{key:2,class:"dev-tip"},{default:n((()=>[m("请在控制台查看详细错误（此提示仅在开发环境展示）")])),_:1})):p("",!0)],64)):(l(),f(y,{key:1},[d(B,{class:"title"},{default:n((()=>[m("实名认证")])),_:1}),d(R,null,{default:n((()=>[d(O,{name:"realName"},{default:n((()=>[d(D,{placeholder:"姓名",class:"input-box",modelValue:r.realName,"onUpdate:modelValue":t[0]||(t[0]=e=>r.realName=e),clearable:!1},null,8,["modelValue"])])),_:1}),d(O,{name:"idCard"},{default:n((()=>[d(D,{placeholder:"身份证号码",class:"input-box",modelValue:r.idCard,"onUpdate:modelValue":t[1]||(t[1]=e=>r.idCard=e),clearable:!1},null,8,["modelValue"])])),_:1})])),_:1}),d(J,{scope:"realNameVerify",ref:"agreements",style:{"margin-bottom":"20px"}},null,512),d(U,{type:"primary",disabled:!s.certifyIdNext,onClick:s.getCertifyId},{default:n((()=>[m("确定")])),_:1},8,["disabled","onClick"])],64))])),_:1}))])),_:1})}],["__scopeId","data-v-3c012959"]]);export{U as default};
